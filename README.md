# اسکریپت Nginx CloudFlare Revese CDN

به‌کمک این اسکریپت ساده، می‌توانید تمامی فرایند نصب پکیج‌های مورد نیاز برای عبور ترافیک از CDN + Nginx رو تنها با یک دستور بصورت خودکار انجام بدید ...

- **نصب آسا‌ن**
- **دریافت خودکار SSL certificate** برای دامنه/ساب‌دامنه 
- **نصب پکیج‌های وابسته** بصورت خودکار 
- **تنظیم ساعت سرور** بصورت خودکار
- **فعال‌سازی خودکار** BBR
- حذف کامل هسته، پاکسازی و **بازگردانی به حالت دیفالت** سرور

<p align="center">
  <br>
  <a href="https://github.com/im-JvD/nginx-Reverce-CDN">
    <img src="https://img.shields.io/badge/Downloads-6-brightgreen
    <img src="https://img.shields.io/badge/License-MIT-blue">
    <img src="https://img.shields.io/badge/Nginx-Automated-success">
  </a>
</p>
‌
<p align="center">
 <a href="#-مراحل-نصب-و-اجرای-اسکریپت">دستور نصب و اجرا</a> - <a href="#تنظیمات-کلودفلر">تنظیمات CloudFlare</a><br> <a href="#نصب-و-تنظیمات-پنل-x-ui">نصب و تنظیمات پنل X-UI</a> - <a href="#تنظیمات-سمت-سرور">تنظیمات سمت سرور</a><br> <a href="#تنظیمات-دستی-کانفیگ-vless-در-اپلیکیشن-کلاینت">تنظیم دستی TLS</a> - <a href="#نکات-قابل-توجه">نکات قابل توجه</a><br> <a href="https://t.me/efnhi/298">منبع آموزش و تولید اسکریپت</a><br>
</p‌>‌
‌
<p align="center">
  <img src="https://github.com/im-JvD/nginx-Reverce-CDN/blob/main/Nginx%20Cloudflare%20CDN.jpg" width="1080px" />
</p‌>
‌
<p align="center">
  ‌ ‌
</p‌>

## 🔧 مراحل نصب و اجرای اسکریپت

برای اجرا و نصب، کافیه که دستور پایین رو داخل ترمینال اجرا کنید تا **به‌صورت خودکار نصب و راه‌اندازی شود** 
‌
<p align="center">
  ‌ ‌
</p‌>

```
curl -fsSL https://github.com/im-JvD/nginx-Reverce-CDN/releases/download/v1.0.0/installer.sh | bash
```
پس از نمایش منوی اسکریپت **مراحل زیر رو به ترتیب** اجرا کنید

___

<p align="center">
  ‌ ‌
</p‌>

### تنظیمات کلودفلر
  - در مرحله اول برید داخل داشبورد کلودفلرتون ، از منوی مدیریتی سمت چپ گزینه **SSL/TLS » Overview** رو بزنید.
  - داخل صفحه باز شده، قسمت **SSL/TLS encryption** و در سمت راست باکس دکمه **Configure** رو بزنید.
  - قسمت پایین صفحه جدیدی که باز میشه ، باکس **Custom SSL/TLS** رو توسط دکمه سفید رنگ زیرش انتخاب کنید . از گزینه‌های موجود در باکس، تیک **Full** رو بزنید و ذخیره کنید .
  - مجدد از منوی سمت چپ ، گزینه **SSL\TLS » Edge Certificates** رو بزنید
  - در صفحه باز شده اسکرول کنید به پایین و وضعیت موارد زیر رو ویرایش و در **حالت فعال (تیک روشن/Enable) قرار بدید** :
‌
    - **Always Use HTTPS** = `Enable`
    - **Minimum TLS Version** = `TLS 1.3`
    - **Opportunistic Encryption** = `Enable`
    - **TLS 1.3** = `Enable`
    - **Automatic HTTPS Rewrites** = `Enable`
‌
  - برگردید به منوی **DNS » Records** و یک رکورد جدید با مشخصات زیر بسازید :‌
    - **Type** = `A`
    - **Value** = `IP Kharej`
    - **Proxy Status** = `Disable`

___

<p align="center">
  ‌ ‌
</p‌>

### نصب و تنظیمات پنل X-UI
  - برگردید به ترمینال سرور مجازیتون و **هر پنل X-UI رو که صلاح می‌دونید** نصب کنید .
  - بعد از نصب، کاری به هیجا نداریم و **مستقیماً میریم سراغ اضافه کردن اینباند** به ترتیب و با مشخصات زیر :
    - **Protocol** = `vless`
    - **Listen IP** = `127.0.0.1`
    - **Port** = `دلخواه (مثلا 54321)`
    - **Transmission** = `WebSocket`
    - **HOST** = `آدرس ساب‌دامنه کلودفلر (sub.example.com)`
    - **Path** = `دلخواه (/yourwspathsecurity)`
    - **External Proxy** = `(www.speedtest.net:443)`
    - **Security** = `none`

___

<p align="center">
  ‌ ‌
</p‌>

### تنظیمات سمت سرور
  - مجدد اسکریپت رو با تایپ دستور **`n-cdn`** اجرا کنید
  - در منوی باز شده، اول توسط گزینه **[1]** تمام وابستگی ها رو نصب کنید .
  - پس از مشاهده پیام سبز رنگ ، توسط گزینه **[2]** میتونید تنظیمات کانفیگ Nginx رو بر اساس پنل **`X-UI`** خودتون انجام بدید .
    - مرحله اول = آدرس **دامنه/ساب‌دامنه** ایجاد شده در کلودفلر
    - مرحله دوم = آدرس **`path`** وب‌سوکت اینباندی که در پنل X-UI ایجاد کردید
    - مرحله سوم = **پورت** اینباندی که ایجاد کردید رو وارد کنید
    - مرحله چهارم = ازتون میپرسه آیا میخواهید اینباند جدیدی رو در کنار اینباند قبلی به فایل کانفیگ اضافه کنید ؟ `( آدرس های path و port نمی‌توانند تکراری باشند )`.
    - ⚠️ دقت داشته باشید که بعد از اعمال تنظیمات فایل Nginx و مشاهده پیام سبز رنگ ، حتما و حتما باید به داشبورد کلوفلرتون برگردید و **تیک پروکسی ساب‌دامینتون رو فعال کنید**
  - به منوی اصلی اسکریپت که برگردید توسط گزینه **`[3]`** میتونید فایل کانفیگ Nginx رو ویرایش کنید .
    - **گزینه اول** = تغییر آدرس **Proxy_pass** - `( لینک کامل وب‌سایتی که قراره روش ریورس بزنید - اختیاری )`
    - **گزینه دوم** = اضافه کردن **ws_path** و **inbound_port** جدید - `( فایل کانفیگ ویرایش میشه و تنظیمات قبلی حفظ میشه )`

___

<p align="center">
  ‌ ‌
</p‌>

### تنظیمات دستی کانفیگ vless در اپلیکیشن کلاینت
  - بعد از انجام دادن همه مراحل بالا ... به پنل **X-UI** برید و کانفیگی که ایجاد کردید رو اکسپورت کنید داخل **`v2rayN ویندوز`** یا **`v2rayNG اندروید`** .
  - در ویندوز **دابل کلیک** روی کانفیگ و در اندروید با **آیکن مداد** ، کانفیگ رو ویرایش کنید .
  - در صفحه باز شده ما فقط قراره که TLS کانفیگ رو فعال کنیم . به همین خاطر **به انتهای پنجره ویرایش برید** و مقایدر رو بصورت زیر ویرایش کنید .
    - **TLS** = `TLS`
    - **SNI** = `دامنه کلودفلر (sub.example.com)`
    - **FingerPrint** = `chrome`
    - **ALPN** = `http/1.1`
    - **Allow InSecure** = `true`
  - در نهایت ذخیره کنید و میبینید که بهتون **هم پینگ میده** و هم **اتصال بصورت مستقیم یا CDN** برقراره ...
___

<p align="center">
  ‌ ‌
</p‌>

### نکات قابل توجه
  - این روش برای ترافیک بالا نیاز به ایمن سازی و رمزنگاری داره ، برای فیلترنشدن دامینتون میتونید از ورکر کلودفلر استفاده کنید.
  - دقت داشته باشید که روش بالا رو میتونید بصورت اوتباند در سرور ایران بصورت ریورس ازش استفاده کنید .
  - برای ایجاد رکورد جدید در کلودفلر اگه از رکورد **`CNAME`** استفاده کنید بهتره .

___
 ‌
<p align="center">
  زنده باد ایران | 28-11-1404
</p‌>
